{% extends 'base.html' %}
{% load static %}

{% block title %}Detalle de Azotea ADR{% endblock %}

{% block sidebar %}
  {% include 'componentes/sidebar.html' %}
{% endblock %}

{% block content %}
<div id="content" class="w-full max-w-screen-2xl mx-auto px-4 py-6 md:ml-72">

  {% comment %}
  item = azotea si existe, sino cae a object (nombre por defecto del DetailView)
  {% endcomment %}
  {% with item=azotea|default:object %}

  <div class="max-w-4xl mx-auto bg-white shadow-lg rounded-2xl overflow-hidden ring-1 ring-black/5">
    <div class="bg-gradient-to-br from-red-600 to-red-700 px-6 py-4 flex items-center justify-between">
      <h2 class="text-2xl font-bold text-white">Detalle de Azotea ADR</h2>

      {% if group_name_singular == 'ADR' or group_name_singular == 'Operador ADR' %}
      <a href="{% url 'edit_azotea_adr' item.pk %}"
         class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-white/10 hover:bg-white/20"
         title="Editar">
        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="w-5 h-5 text-white" viewBox="0 0 24 24">
          <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"/>
        </svg>
      </a>
      {% endif %}
    </div>

    <div class="px-6 py-6 grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4 text-gray-800">
      <div><p class="text-sm text-gray-500 font-semibold">Activo</p><p class="text-base">{{ item.activo|default:"—" }}</p></div>
      <div><p class="text-sm text-gray-500 font-semibold">Estado</p><p class="text-base">{{ item.estado|default:"—" }}</p></div>

      <div><p class="text-sm text-gray-500 font-semibold">Marca</p><p class="text-base">{{ item.marca|default:"—" }}</p></div>
      <div><p class="text-sm text-gray-500 font-semibold">Modelo</p><p class="text-base">{{ item.modelo|default:"—" }}</p></div>

      <div><p class="text-sm text-gray-500 font-semibold">N° Serie</p><p class="text-base break-all">{{ item.n_serie|default:"—" }}</p></div>
      <div><p class="text-sm text-gray-500 font-semibold">UNIVE</p><p class="text-base break-all">{{ item.unive|default:"—" }}</p></div>

      <div><p class="text-sm text-gray-500 font-semibold">BDO</p><p class="text-base break-all">{{ item.bdo|default:"—" }}</p></div>
      <div><p class="text-sm text-gray-500 font-semibold">NetBIOS</p><p class="text-base break-all">{{ item.netbios|default:"—" }}</p></div>

      <div class="md:col-span-2">
        <p class="text-sm text-gray-500 font-semibold">Ubicación</p>
        <p class="text-base break-words">{{ item.ubicacion|default:"—" }}</p>
      </div>

      <div>
        <p class="text-sm text-gray-500 font-semibold">Registrado por</p>
        <p class="text-base">
          {% if item.creado_por %}
            {{ item.creado_por.get_full_name|default:item.creado_por.username }}
          {% else %}
            N/A
          {% endif %}
        </p>
      </div>

      <div>
        <p class="text-sm text-gray-500 font-semibold">Fecha de creación</p>
        <p class="text-base">{{ item.fecha_creacion|date:"d/m/Y H:i" }}</p>
      </div>

      <div>
        <p class="text-sm text-gray-500 font-semibold">Última modificación</p>
        <p class="text-base">{{ item.fecha_modificacion|date:"d/m/Y H:i" }}</p>
      </div>
    </div>

    {# Historial de cambios opcional (mismo estilo que Proyector) #}
    <div class="px-6 pb-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-2">Historial de cambios</h3>
      {% if historial_cambios %}
      <div class="relative overflow-x-auto rounded ring-1 ring-black/5">
        <table class="w-full table-auto bg-white text-sm">
          <thead class="bg-gray-100 text-gray-700">
            <tr>
              <th class="px-2 py-2 text-left">Fecha</th>
              <th class="px-2 py-2 text-left">Usuario</th>
              <th class="px-2 py-2 text-left">Campo</th>
              <th class="px-2 py-2 text-left">Valor anterior</th>
              <th class="px-2 py-2 text-left">Valor nuevo</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            {% for h in historial_cambios %}
            <tr>
              <td class="px-2 py-2 whitespace-nowrap">{{ h.fecha_modificacion|date:"d/m/Y H:i" }}</td>
              <td class="px-2 py-2">{{ h.usuario.get_full_name|default:h.usuario.username }}</td>
              <td class="px-2 py-2">{{ h.campo_modificado }}</td>
              <td class="px-2 py-2 break-words">{{ h.valor_anterior }}</td>
              <td class="px-2 py-2 break-words">{{ h.valor_nuevo }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
        <p class="text-gray-600">No hay historial de cambios para este registro.</p>
      {% endif %}
    </div>

    <div class="bg-gray-50 px-6 py-4 flex justify-between">
      {% if group_name_singular == 'ADR' or group_name_singular == 'Operador ADR' %}
      <a href="{% url 'edit_azotea_adr' item.pk %}"
         class="inline-flex items-center justify-center px-4 h-10 rounded bg-zinc-800 text-white hover:bg-zinc-900">
        Editar
      </a>
      {% else %}<span></span>{% endif %}

      {% if list_url_name %}
        <a href="{% url list_url_name %}" class="inline-flex items-center justify-center px-4 h-10 rounded bg-gray-600 text-white hover:bg-gray-700">
          Volver al listado
        </a>
      {% else %}
        <a href="{% url 'azotea_adr' %}" class="inline-flex items-center justify-center px-4 h-10 rounded bg-gray-600 text-white hover:bg-gray-700">
          Volver al listado
        </a>
      {% endif %}
    </div>
  </div>

  {% endwith %}
</div>
{% endblock %}
